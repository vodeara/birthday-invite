<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#ff6f61">
  <title>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è üéâ</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body class="scene" id="body">

  <!-- üë• –û–Ω–ª–∞–π–Ω-—Å—á—ë—Ç—á–∏–∫ –°–õ–ï–í–ê –°–í–ï–†–•–£ -->
  <div id="onlineCounter" style="position: fixed; left: 20px; top: 20px; font-size: 14px; font-weight: 500; background: rgba(255,255,255,0.9); padding: 8px 12px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000;">
    –°–µ–π—á–∞—Å –Ω–∞ —Å–∞–π—Ç–µ: <span id="onlineNumber">1</span> üéà
  </div>

  <!-- –≠–∫—Ä–∞–Ω 1: –≥–ª–∞–≤–Ω–∞—è -->
  <section class="screen screen-home" id="homeScreen">
    <div class="card">
      <h1>üéÇ –ú–æ–π –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è!</h1>
      <p class="sub">–ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—è</p>
      <button id="openBtn" class="open-btn">–û—Ç–∫—Ä—ã—Ç—å</button>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω 2: –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ -->
  <section class="screen screen-invite" id="inviteScreen">
    <div class="invite-card">
      <button id="closeBtn" class="close-btn">‚úï</button>
      <h1>üéâ –ü—Ä–∏–≥–ª–∞—à–∞—é —Ç–µ–±—è –Ω–∞ —Å–≤–æ–π –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è!</h1>
      <p class="lead">
        –ë—É–¥—É —Ä–∞–¥ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è <b>?? –¥–µ–∫–∞–±—Ä—è –≤ ??:00</b> —É –º–æ–µ–≥–æ –¥–æ–º–∞ ‚Äî –ü–µ—Ç—Ä–∞ –¢–∞—Ä–∞—Å–æ–≤–∞ 21.<br>
        –û—Ç—Ç—É–¥–∞ –º—ã –Ω–∞–ø—Ä–∞–≤–∏–º—Å—è –≤ <b>–ê–î–†–ï–°–°–ê–î–†–ï–°–°–ê–î–†–ï–°–°</b> –∏ —Ç–∞–º –±—É–¥–µ–º –¥–æ ?? –¥–µ–∫–∞–±—Ä—è ??:00 üéä
      </p>
      
      <div class="gifts">
        <h3>üéÅ –ò–¥–µ–∏ –ø–æ–¥–∞—Ä–∫–æ–≤</h3>
        <div class="gift-list">
          <a class="gift" href="https://followish.io/mywishlist/i4cxtz6hnymgxk" target="_blank" rel="noopener noreferrer">
            <div class="gift-icon">üéÅ</div>
            <span>–í–∏—à–ª–∏—Å—Ç</span>
          </a>
        </div>
      </div>
      
      <div class="controls">
        <button id="toggleMusic" class="music-btn">‚ñ∂ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>
      </div>
    </div>
  </section>

  <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏ –º—É–∑—ã–∫–∞ -->
  <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
  <audio id="bgMusic" src="music.mp3" loop></audio>
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º JS -->
  <script src="confetti.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const openBtn = document.getElementById('openBtn');
        const closeBtn = document.getElementById('closeBtn');
        const inviteScreen = document.getElementById('inviteScreen');
        const homeScreen = document.getElementById('homeScreen');
        const bgMusic = document.getElementById('bgMusic');
        const toggleMusic = document.getElementById('toggleMusic');
        const confettiCanvas = document.getElementById('confettiCanvas');
        const body = document.getElementById('body');

        function openInvitation() {
            body.classList.add('flip');
            if (confettiCanvas && window.confettiStart) {
                confettiCanvas.style.display = 'block';
                window.confettiStart();
            }
            if (bgMusic && toggleMusic) {
                bgMusic.play().catch(() => {});
                toggleMusic.textContent = '‚è∏ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É';
            }
        }

        function closeInvitation() {
            body.classList.remove('flip');
            if (confettiCanvas && window.confettiStop) {
                confettiCanvas.style.display = 'none';
                window.confettiStop();
            }
            if (bgMusic && toggleMusic) {
                bgMusic.pause();
                toggleMusic.textContent = '‚ñ∂ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É';
            }
        }

        function toggleMusicFunc() {
            if (bgMusic.paused) {
                bgMusic.play();
                toggleMusic.textContent = '‚è∏ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É';
            } else {
                bgMusic.pause();
                toggleMusic.textContent = '‚ñ∂ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É';
            }
        }

        openBtn.addEventListener('click', openInvitation);
        closeBtn.addEventListener('click', closeInvitation);
        toggleMusic.addEventListener('click', toggleMusicFunc);
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && body.classList.contains('flip')) {
                closeInvitation();
            }
        });

        // –†–µ–∞–ª—å–Ω—ã–π –æ–Ω–ª–∞–π–Ω-—Å—á—ë—Ç—á–∏–∫ —á–µ—Ä–µ–∑ WebSocket
        const userId = Math.random().toString(36).substr(2, 9);
        const socket = new WebSocket('wss://realtimeapi.io/api/live');

        socket.onopen = () => {
          socket.send(JSON.stringify({ event: 'join', room: 'birthday_invite_room', user: userId }));
        };

        socket.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            if (data.room === 'birthday_invite_room' && data.count !== undefined) {
              document.getElementById('onlineNumber').textContent = data.count;
            }
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ WebSocket:', e);
            // Fallback - –ø—Ä–æ—Å—Ç–æ–π —Å—á–µ—Ç—á–∏–∫
            let current = parseInt(document.getElementById('onlineNumber').textContent) || 1;
            document.getElementById('onlineNumber').textContent = current + 1;
          }
        };

        window.addEventListener('beforeunload', () => {
          socket.send(JSON.stringify({ event: 'leave', room: 'birthday_invite_room', user: userId }));
        });
    });
  </script>
</body>
</html>

